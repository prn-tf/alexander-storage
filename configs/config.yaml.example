# Alexander Storage Configuration
# Copy this file to config.yaml and update values

server:
  host: "0.0.0.0"
  port: 8080
  read_timeout: 30s
  write_timeout: 60s
  idle_timeout: 120s
  max_header_bytes: 1048576  # 1MB
  shutdown_timeout: 30s

# TLS configuration (optional)
tls:
  enabled: false
  cert_file: ""
  key_file: ""
  port: 8443

# PostgreSQL database
database:
  host: "localhost"
  port: 5432
  user: "alexander"
  password: "alexander"
  database: "alexander"
  sslmode: "disable"
  max_open_conns: 25
  max_idle_conns: 5
  conn_max_lifetime: 5m
  conn_max_idle_time: 5m

# Redis cache and distributed locking
redis:
  host: "localhost"
  port: 6379
  password: ""
  db: 0
  pool_size: 10
  min_idle_conns: 5

# Storage backend configuration
storage:
  # Backend type: "filesystem", "s3" (future)
  backend: "filesystem"
  
  # Filesystem backend settings
  filesystem:
    base_path: "/data"
    # Use 2-level directory sharding: /ab/cd/abcdef...
    shard_levels: 2
    shard_width: 2

# Authentication and security
auth:
  # Master key for encrypting secret keys (AES-256)
  # In production, use environment variable: ALEXANDER_AUTH_MASTER_KEY
  # Generate with: openssl rand -hex 32
  master_key: ""
  
  # Default region for AWS v4 signature
  region: "us-east-1"
  
  # Service name for signature
  service: "s3"

# Multipart upload settings
multipart:
  # Maximum part size (5GB S3 limit)
  max_part_size: 5368709120
  # Minimum part size (5MB S3 limit, except last part)
  min_part_size: 5242880
  # Maximum number of parts
  max_parts: 10000
  # Upload expiration (cleanup incomplete uploads)
  expiration: 168h  # 7 days

# Garbage collection for orphan blobs
gc:
  enabled: true
  interval: 1h
  # Grace period before deleting orphan blobs
  grace_period: 24h
  # Number of blobs to process per run
  batch_size: 1000
  # Dry run mode (log without deleting)
  dry_run: false

# Logging
logging:
  level: "info"  # debug, info, warn, error
  format: "json"  # json, console
  # Output file (empty for stdout)
  file: ""

# Metrics (Prometheus)
metrics:
  enabled: true
  port: 9091
  path: "/metrics"

# Rate limiting
rate_limit:
  enabled: true
  # Requests per second per client
  requests_per_second: 100
  # Burst capacity (max requests before limiting)
  burst_size: 200
  # Bandwidth limiting (optional)
  bandwidth_enabled: false
  bytes_per_second: 104857600  # 100 MB/s

# Health check endpoints
# Available endpoints:
#   GET /health  - Full component status with latency
#   GET /healthz - Kubernetes liveness probe
#   GET /readyz  - Kubernetes readiness probe
